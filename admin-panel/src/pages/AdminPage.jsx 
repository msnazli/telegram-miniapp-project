import React, { useEffect, useState } from 'react';

const AdminPage = () => {
  const [language, setLanguage] = useState('fa');
  const [translations, setTranslations] = useState({});
  const [newKey, setNewKey] = useState('');
  const [newValue, setNewValue] = useState('');

  // Ø¯Ø±ÛŒØ§ÙØª ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³Ø±ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø²Ø¨Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡
  const fetchTranslations = async () => {
    try {
      const res = await fetch(`http://localhost:5000/api/translations/${language}`);
      const data = await res.json();
      setTranslations(data || {});
    } catch (err) {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§', err);
    }
  };

  useEffect(() => {
    fetchTranslations();
  }, [language]);

  // Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
  const handleSave = async () => {
    try {
      const res = await fetch(`http://localhost:5000/api/translations/${language}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(translations),
      });
      if (res.ok) alert('âœ… ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯');
    } catch (err) {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡', err);
    }
  };

  // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯
  const handleAddKey = () => {
    if (!newKey.trim()) return;
    setTranslations((prev) => ({
      ...prev,
      [newKey]: newValue,
    }));
    setNewKey('');
    setNewValue('');
  };

  // ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ù‚Ø¯Ø§Ø± ÛŒÚ© Ú©Ù„ÛŒØ¯
  const handleEditKey = (key, value) => {
    setTranslations((prev) => ({
      ...prev,
      [key]: value,
    }));
  };

  // Ø­Ø°Ù Ú©Ù„ÛŒØ¯
  const handleDeleteKey = (key) => {
    const updated = { ...translations };
    delete updated[key];
    setTranslations(updated);
  };

  return (
    <div className="container mt-5">
      <h2 className="mb-4">Ù…Ø¯ÛŒØ±ÛŒØª ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§</h2>

      <div className="mb-3">
        <label>Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†:</label>
        <select value={language} onChange={(e) => setLanguage(e.target.value)} className="form-select w-auto d-inline-block ms-2">
          <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
          <option value="en">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</option>
        </select>
      </div>

      <div className="mb-4 d-flex gap-2">
        <input
          type="text"
          placeholder="Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯"
          value={newKey}
          onChange={(e) => setNewKey(e.target.value)}
          className="form-control w-25"
        />
        <input
          type="text"
          placeholder="Ù…Ù‚Ø¯Ø§Ø±"
          value={newValue}
          onChange={(e) => setNewValue(e.target.value)}
          className="form-control w-50"
        />
        <button onClick={handleAddKey} className="btn btn-success">Ø§ÙØ²ÙˆØ¯Ù†</button>
      </div>

      <table className="table table-bordered">
        <thead>
          <tr>
            <th>Ú©Ù„ÛŒØ¯</th>
            <th>Ù…Ù‚Ø¯Ø§Ø±</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
          </tr>
        </thead>
        <tbody>
          {Object.entries(translations).map(([key, value]) => (
            <tr key={key}>
              <td>{key}</td>
              <td>
                <input
                  type="text"
                  value={value}
                  onChange={(e) => handleEditKey(key, e.target.value)}
                  className="form-control"
                />
              </td>
              <td>
                <button onClick={() => handleDeleteKey(key)} className="btn btn-danger btn-sm">Ø­Ø°Ù</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      <button onClick={handleSave} className="btn btn-primary">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
    </div>
  );
};

export default AdminPage;
